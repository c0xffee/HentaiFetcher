# Implementation Plan

> æ­¤æª”æ¡ˆè¨˜éŒ„é–‹ç™¼é€²åº¦èˆ‡å¾…è¾¦äº‹é …ã€‚
> æ¯å®Œæˆä¸€å€‹æ­¥é©Ÿï¼Œè«‹å°‡ `[ ]` æ”¹ç‚º `[x]`ã€‚

---

## âœ… Phase 0: Documentation (æ–‡ä»¶å»ºç«‹)
- [x] Step 0.1: å»ºç«‹ Vibe Coding æ–‡ä»¶æ¶æ§‹
- [x] Step 0.2: å»ºç«‹ Memory Bank è³‡æ–™å¤¾èˆ‡æ¨¡æ¿
- [x] Step 0.3: åŠ å¼·è‡ªå‹•æ›´æ–°è¦å‰‡ (Auto-Update Protocol)
- [ ] Step 0.4: é€²è¡Œé¡§å•å¼è¨ªè«‡ï¼Œæ”¶æ–‚éœ€æ±‚
- [ ] Step 0.5: å®Œå–„æ‰€æœ‰ Memory Bank æ–‡ä»¶

---

## ğŸ“‹ Phase 1: Foundation (åŸºç¤å»ºè¨­) - å·²å®Œæˆ
> æ­¤éšæ®µå·²ç”±ç¾æœ‰ç¨‹å¼ç¢¼å®Œæˆ

- [x] Step 1.1: Discord Bot åŸºç¤æ¡†æ¶
- [x] Step 1.2: gallery-dl æ•´åˆ
- [x] Step 1.3: PDF è½‰æ›åŠŸèƒ½
- [x] Step 1.4: Eagle metadata ç”Ÿæˆ
- [x] Step 1.5: Docker å®¹å™¨åŒ–

---

## ğŸš€ Phase 2: Enhancement (åŠŸèƒ½å¢å¼·) - é€²è¡Œä¸­
> Eagle æ’ä»¶é–‹ç™¼

- [x] Step 2.1: Eagle NAS Auto-Importer æ’ä»¶
  - èƒŒæ™¯æœå‹™æ¯ 30 ç§’æƒæ NAS è³‡æ–™å¤¾
  - è‡ªå‹•åŒ¯å…¥ PDF åˆ° Eagle
  - è®€å– metadata.json å¡«å¯«æ¨™ç±¤/ç¶²å€/è¨»é‡‹
  - åŒ¯å…¥å¾Œæ­¸æª”åˆ° imported è³‡æ–™å¤¾
- [ ] Step 2.2: [å¾…ç¢ºèªåŠŸèƒ½]
- [ ] Step 2.3: [å¾…ç¢ºèªåŠŸèƒ½]

---

## ğŸ® Phase 3: UI Components (Discord äº’å‹•å…ƒä»¶) âœ… å·²å®Œæˆ
> ä½¿ç”¨ discord.py View/Button/Select æå‡ä½¿ç”¨é«”é©—

### Step 3.1: åŸºç¤æ¶æ§‹ âœ…
- [x] å»ºç«‹ `bot/views/` è³‡æ–™å¤¾çµæ§‹
- [x] å¯¦ä½œæŒä¹…åŒ– View åŸºç¤é¡åˆ¥ (Bot é‡å•Ÿå¾ŒæŒ‰éˆ•ä»å¯ç”¨)
- [x] è¨­å®š 5 åˆ†é˜è¶…æ™‚æ©Ÿåˆ¶

### Step 3.2: SearchResultView (æœå°‹çµæœ) âœ…
- [x] Select Menu é¸æ“‡ä½œå“ â†’ è‡ªå‹•åŸ·è¡Œ `/read`
- [x] æŒ‰éˆ•ï¼š`ğŸ”€ éš¨æ©Ÿä¸€æœ¬`ã€`âŒ é—œé–‰`
- [x] custom_id æ ¼å¼ï¼š`search_select`

### Step 3.3: ReadDetailView (è©³æƒ…é ) âœ…
- [x] æŒ‰éˆ•ï¼š`ğŸ“„ é–‹å•Ÿ PDF`ã€`ğŸ”— nhentai`
- [x] æŒ‰éˆ•ï¼š`ğŸ” åŒä½œè€…`ã€`ğŸ” åŒåŸä½œ`ã€`ğŸ“¥ é‡æ–°ä¸‹è¼‰`ã€`ğŸ”€ éš¨æ©Ÿä¸€æœ¬`
- [x] **Tag Select Menu**ï¼šé¸æ“‡æ¨™ç±¤æœå°‹åŒé¡ä½œå“
- [x] custom_id æ ¼å¼ï¼š`read_*`ã€`tag_select`ã€`artist_search:*`

### Step 3.4: RandomResultView (éš¨æ©Ÿçµæœ) âœ…
- [x] æŒ‰éˆ•ï¼š`ğŸ“– è©³ç´°è³‡è¨Š`ã€`ğŸ“„ é–‹å•Ÿ PDF`ã€`ğŸ”€ å†æŠ½ä¸€æ¬¡`
- [x] æŒ‰éˆ•ï¼š`ğŸ“¥ ä¸‹è¼‰æ­¤æœ¬`
- [x] custom_id æ ¼å¼ï¼š`random_*`

### Step 3.5: DownloadCompleteView (ä¸‹è¼‰å®Œæˆ) âœ…
- [x] æŒ‰éˆ•ï¼š`ğŸ“„ é–‹å•Ÿ PDF`ã€`ğŸ“– æŸ¥çœ‹è©³æƒ…`ã€`ğŸ”— nhentai`
- [x] æŒ‰éˆ•ï¼š`ğŸ“¥ ç¹¼çºŒä¸‹è¼‰`
- [x] custom_id æ ¼å¼ï¼š`dl_*`

### Step 3.6: PaginatedListView (åˆ†é åˆ—è¡¨) âœ…
- [x] åˆ†é æŒ‰éˆ•ï¼š`â¬…ï¸ ä¸Šä¸€é `ã€`â¡ï¸ ä¸‹ä¸€é `
- [x] å°èˆªæŒ‰éˆ•ï¼š`â®ï¸ é¦–é `ã€`â­ï¸ æœ«é `
- [x] å¿«æ·æŒ‰éˆ•ï¼š`ğŸ”€ éš¨æ©Ÿ`ã€`âŒ é—œé–‰`
- [x] æ¯é  15 ç­†ï¼Œä½¿ç”¨ Embed é¡¯ç¤º

---

## âš¡ Phase 4: PDF Linearization (PDF ç·šæ€§åŒ–) âœ… å®Œæˆ
> ä½¿ç”¨ pikepdf åŠ é€Ÿç¶²é  PDF å­˜å– (Fast Web View)

### Step 4.1: å°é‡æ¸¬è©¦ âœ… å®Œæˆ
- [x] å®‰è£ pikepdf ä¾è³´
- [x] åŠŸèƒ½ 1 æ¸¬è©¦ï¼šPillow è£½ä½œ PDF â†’ pikepdf ç·šæ€§åŒ–
- [x] åŠŸèƒ½ 2 æ¸¬è©¦ï¼šç¾æœ‰ PDF â†’ pikepdf ç·šæ€§åŒ–
- [x] æ•ˆèƒ½æ¸¬è©¦é€šé (143MB PDF ç·šæ€§åŒ–åƒ…éœ€ 1.33 ç§’)
- [x] æ¸¬è©¦è…³æœ¬å·²æ¸…ç†

### Step 4.2: ç¾å­˜ PDF ç·šæ€§åŒ– âœ… å®Œæˆ
- [x] æƒæ `downloads/` è³‡æ–™å¤¾æ‰€æœ‰ PDF
- [x] æƒæ `imported/` è³‡æ–™å¤¾æ‰€æœ‰ PDF (Eagle å·²åŒ¯å…¥)
- [x] æƒæ Eagle Library (`\\192.168.10.2\docker\Eagle\nHentai.library\images`)
- [x] ç·šæ€§åŒ–ä¸¦è¦†å¯«åŸæª”
- [x] çµ±è¨ˆï¼š196 å€‹ PDF (4.61 GB)ï¼Œè€—æ™‚ 196 ç§’ï¼Œ0 å¤±æ•—
- [x] ä¸€æ¬¡æ€§è…³æœ¬å·²æ¸…ç†

### Step 4.3: æ•´åˆåˆ° Bot âœ… å®Œæˆ
- [x] ä¿®æ”¹ `run.py` çš„ `convert_to_pdf()` æ–¹æ³•
- [x] æµç¨‹ï¼šPillow â†’ BytesIO â†’ pikepdf ç·šæ€§åŒ– â†’ å¯«å…¥æª”æ¡ˆ
- [x] é€²åº¦å›å ±æ”¹ç‚º 4 éšæ®µ (åˆ†æ/ç­‰å¯¬/ç”Ÿæˆ/ç·šæ€§åŒ–)
- [x] æ›´æ–° Dockerfile åŠ å…¥ pikepdf
- [x] ç·šæ€§åŒ–å¤±æ•—æ™‚è‡ªå‹• fallback ç‚ºéç·šæ€§åŒ–å­˜æª”

---

## ğŸ”„ Phase 5: Refactoring (é‡æ§‹é€±æœŸ) - å¾…è¦åŠƒ
> ç¨‹å¼ç¢¼å“è³ªæ”¹å–„

- [ ] Step 5.1: æ¨¡çµ„åŒ–æ‹†åˆ† (run.py ç›®å‰ç´„ 3800 è¡Œ)
- [ ] Step 5.2: æ–°å¢å–®å…ƒæ¸¬è©¦
- [ ] Step 5.3: éŒ¯èª¤è™•ç†å„ªåŒ–

---

## ğŸ§ª Phase 6: Testing (æ¸¬è©¦å»ºç«‹) - å¾…è¦åŠƒ

- [ ] Step 6.1: å»ºç«‹æ¸¬è©¦æ¡†æ¶
- [ ] Step 6.2: æ ¸å¿ƒåŠŸèƒ½å–®å…ƒæ¸¬è©¦
- [ ] Step 6.3: æ•´åˆæ¸¬è©¦

---

## ğŸ“ Changelog (è®Šæ›´æ—¥èªŒ)

### 2026-01-02 (v3.3.0) ğŸ® UI Components
- **feat: Discord UI äº’å‹•å…ƒä»¶æ•´åˆ**
  - å»ºç«‹ `bot/views/` æ¨¡çµ„åŒ–æ¶æ§‹
  - `SearchResultView` - æœå°‹çµæœ Select Menu â†’ ä¸€éµæŸ¥çœ‹è©³æƒ…
  - `ReadDetailView` - è©³æƒ…é æŒ‰éˆ• + Tag Select Menu
  - `RandomResultView` - éš¨æ©Ÿçµæœæ“ä½œæŒ‰éˆ•
  - `DownloadCompleteView` - ä¸‹è¼‰å®Œæˆå¾Œå¿«æ·æŒ‰éˆ•
  - `PaginatedListView` - åˆ†é åˆ—è¡¨ (æ¯é 15ç­†ï¼Œä¸Š/ä¸‹é æŒ‰éˆ•)
- **feat: Tag æœå°‹åŠŸèƒ½**
  - è©³æƒ…é  Tag Select Menu å¯æœå°‹åŒé¡ä½œå“
  - åŒä½œè€…/åŒåŸä½œ ä¸€éµæœå°‹æŒ‰éˆ•
- **feat: eagle_library.py æ–°å¢ `find_by_tag()` æ–¹æ³•**
- **feat: `/list` æ”¹ç‚ºåˆ†é  Embed é¡¯ç¤º**
- **fix: update_final_progress ä½¿ç”¨ gallery_id å–ä»£ media_id**

### 2026-01-02 (v3.1.0)
- **feat: `/random` downloads ä½¿ç”¨ PDF URL**
  - downloads ä¾†æºæ”¹ç”¨ `http://192.168.0.32:8888/{id}/{id}.pdf`
  - ä¸å†é¡¯ç¤º nhentai ç¶²å€
- **fix: `/random count` é¡¯ç¤ºé †åº**
  - ä¸€æœ¬é¡¯ç¤ºå®Œå†å‚³ä¸‹ä¸€æœ¬
  - å…ˆå‚³å°é¢ï¼Œå†å‚³è³‡è¨Š
- **docs: æ–°å¢ Help-Sync è¦å‰‡**
  - AI ä¿®æ”¹æŒ‡ä»¤æ™‚å¿…é ˆåŒæ­¥æ›´æ–° /help
- **feat: `/random` æŒ‡ä»¤æ”¯æ´ä¾†æºé¸æ“‡**
  - æ–°å¢ `source` åƒæ•¸ï¼š`eagle`ã€`downloads`ã€`all`
  - é è¨­å¾ Eagle Library éš¨æ©Ÿ
  - å¯é¸æ“‡å¾ä¸‹è¼‰è³‡æ–™å¤¾æˆ–å…¨éƒ¨ä¾†æºéš¨æ©Ÿ
  - ä½¿ç”¨ `secrets` æ¨¡çµ„æå‡éš¨æ©Ÿæ€§
- **feat: `/list` æŒ‡ä»¤é¡¯ç¤ºå…¨éƒ¨æœ¬å­**
  - åˆä½µé¡¯ç¤º Eagle Library å’Œä¸‹è¼‰è³‡æ–™å¤¾
  - ğŸ¦… è¡¨ç¤º Eagleï¼ŒğŸ“ è¡¨ç¤ºä¸‹è¼‰è³‡æ–™å¤¾
  - é¡¯ç¤ºå„ä¾†æºçµ±è¨ˆæ•¸é‡
- **feat: æ‰¹æ¬¡ä¸‹è¼‰å®Œæˆç¸½çµ**
  - å¤šæª”æ¡ˆä¸‹è¼‰å®Œæˆå¾Œé¡¯ç¤ºçµ±è¨ˆ
  - é¡¯ç¤ºæˆåŠŸ/å¤±æ•—æ•¸é‡
  - åˆ—å‡ºå¤±æ•—çš„ Gallery ID
- **fix: æ”¹å–„éš¨æ©Ÿæ¼”ç®—æ³•**
  - eagle_library.py æ”¹ç”¨ `secrets.randbelow()` 
  - æä¾›åŠ å¯†å®‰å…¨ç­‰ç´šçš„éš¨æ©Ÿé¸å–

### 2026-01-02
- **feat: Eagle NAS Auto-Importer æ’ä»¶**
  - å»ºç«‹ `Eagle-Auto-Importer/` æ’ä»¶ç›®éŒ„
  - `manifest.json` - è¨­å®šç‚º background service
  - `index.html` - æ’ä»¶ UI é¡¯ç¤ºæœå‹™ç‹€æ…‹èˆ‡æ—¥èªŒ
  - `js/plugin.js` - æ ¸å¿ƒé‚è¼¯
    - å®šæ™‚æƒæ NAS è³‡æ–™å¤¾ (å¯è¨­å®šé–“éš”)
    - è‡ªå‹•åŒ¯å…¥ PDF æª”æ¡ˆåˆ° Eagle
    - è®€å– metadata.json ä¸¦æ›´æ–° Eagle é …ç›®è³‡è¨Š
    - åŒ¯å…¥æˆåŠŸå¾Œè‡ªå‹•æ­¸æª”
  - å»ºç«‹ `imported/` è³‡æ–™å¤¾ç”¨æ–¼æ­¸æª”
- **fix: PDF ç­‰å¯¬åŠŸèƒ½**
  - æ”¹ç”¨ Pillow å–ä»£ img2pdf é€²è¡Œ PDF è½‰æ›
  - è‡ªå‹•æ‰¾å‡ºæœ€å¤§å¯¬åº¦ï¼Œå°‡æ‰€æœ‰åœ–ç‰‡æŒ‰æ¯”ä¾‹ç¸®æ”¾è‡³çµ±ä¸€å¯¬åº¦
  - ç¢ºä¿ PDF æ¯é éƒ½æ˜¯ 100% å¯¬åº¦å°é½Š
  - æ”¯æ´ RGBA/P/LA ç­‰é€æ˜åœ–ç‰‡æ¨¡å¼è½‰æ›ç‚º RGB
- å»ºç«‹ Vibe Coding æ–‡ä»¶æ¶æ§‹
- åˆå§‹åŒ– Memory Bank
